name: Warm-up Vercel

on:
  deployment_status:
  schedule:
    - cron: "*/10 * * * *" ## every 10 minutes

jobs:
  warm-up:
    if: |
      !github.event.deployment_status || (github.event.deployment_status.state == 'success')
    runs-on: ubuntu-20.04
    steps:
      - name: Visit URLs that use AWS Lambda
        run: |
          for PATHNAME in "/@hash" "/types/DUMMY_ENTITY_ID"
          do
            echo ""
            echo ""
            echo "========"
            echo "${BASE_URL}${PATHNAME}"
            echo "========"
            echo ""
            time curl --head "${BASE_URL}${PATHNAME}"
          done
        env:
          BASE_URL: "${{ github.event.deployment_status ? github.event.deployment_status.target_url : 'https://blockprotocol.org' }}"
